---
title: "NL East Standings"
author: "Nick Hatley"
date: "2019-09-02"
output:
  blogdown::html_page
categories: ["R"]
slug: nl_east

tags: ["R Markdown", "blogdown"]
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning =  FALSE)
knitr::opts_chunk$set(message = FALSE)
options(knitr.table.format = "html")
```

```{r}
library(tidyverse)
library(gganimate)
plot_theme = function (base_size = 9) {
  theme_bw(base_size = base_size) %+replace% 
    theme(plot.title = element_text( 
      size = 13, 
      margin = margin(b=4, unit = "pt"), 
      hjust = 0, vjust = 0
    ),
    plot.subtitle = element_text(
      size = 9, 
      face = "italic", 
      colour = "#595959", 
      margin = margin(b = 6, unit = "pt"), 
      hjust = 0, vjust = 0
    ), 
    plot.caption = element_text(
      size = 10,
      color = "#7F7F7F", 
      hjust = .92, vjust = 0,
      face = "italic"
    ),
    axis.title = element_text(color = "gray8", size = 10),
    axis.text = element_text(color = "gray8", size = 9), 
    
    axis.line = element_line(color = "#A4A4A4", size = .2),
    strip.text.x = element_text(color = "gray8", size = 10, margin = margin(.175,0,
                                                                         .175,0, "cm")),
    strip.text.y = element_text(color = "gray8", size = 10, margin = margin(0,.175,
                                                                            0,.175, "cm")),
    strip.background = element_rect(fill = "#f8f2e4", size = 1.2),
    
    #axis.ticks = element_line(color = "#A4A4A4", size = .2),
    axis.ticks = element_blank(),
    axis.ticks.length = unit(8, "pt"),
    legend.title = element_blank(),
    legend.margin=margin(0,0,0,0),
    legend.position = "bottom",
    legend.box.margin=margin(-5,-10, 0,-10),
    panel.grid = element_line(color = "#A4A4A4", size = .2),
    
    panel.grid.major.y = element_line(linetype = "solid", color = "#A4A4A4", size = .75),
    panel.grid.major.x = element_line(linetype = "solid", color = "#A4A4A4", size = .15),
    panel.grid.minor.y = element_line(linetype = "dotted", color = "#A4A4A4", size = .4),
    panel.grid.minor.x = element_line(linetype = "dotted", color = "#A4A4A4", size = .4),
    #panel.border = element_blank(), 
    complete = TRUE
    )
}
```

```{r}

#, results=FALSE

# standings_path <- fs::dir_info(here::here("data/standings/historical/")) %>%
#   filter(type == "file") %>% 
#   pull(path)

standings <- read_rds("../../../mlb_db/data/standings/historical/standings_thru_09_03.rds")

nl_east_wins <- standings %>% 
  filter(division == "NL East") %>% 
  filter(team_abbrev != "MIA") %>% 
  group_by(team_abbrev,up_to_date) %>% 
  summarise(wins = sum(wins),
            losses = sum(losses),
            gb = sum(gb)
  ) %>% 
  ungroup

nl_east_colors_primary = list(
  ATL = "#13274F",
  PHI = "#E81828",
  NYM = "#002D72",
  WSN = "#AB0003"
)
nl_east_colors_secondary = list(
  ATL = "#CE1141",
  PHI = "#002D72",
  NYM = "#FF5910",
  WSN = "#14225A"  
)


nl_east_wins = nl_east_wins %>% 
  group_by(up_to_date) %>% 
  mutate(games = sum(wins, losses) / 4 %>% round(0)) %>% 
  ungroup %>% 
  mutate(games = round(games, 0))

p = nl_east_wins %>% 
  ggplot(
    aes(
      x = up_to_date,
      y = wins,
      group = team_abbrev
    )
  ) + 
  geom_point(
    aes(color = team_abbrev),
    shape = 21, size = rel(2.5), stroke = rel(2.25),
    fill = "white"
  ) + 
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(0, 100, by = 10),
                     labels = seq(0, 100, by = 10)
  ) +
  geom_line(
    #aes(color = team_abbrev),
    size = rel(.65)
  ) + 
  geom_segment(
    aes(xend = max(nl_east_wins$up_to_date) + 2, 
        yend = wins),
    linetype = 2, colour = 'grey') + 
  geom_text(
    aes(
      max(nl_east_wins$up_to_date) + 2.5,
      label = paste(team_abbrev, " :: ", wins), hjust = 0)) + 
  scale_color_manual(values = nl_east_colors_primary) + 
  transition_reveal(up_to_date) + 
  #coord_cartesian(clip = 'off') + 
  plot_theme() +
  theme(legend.position = "bottom",
        legend.direction = "horizontal",
        legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank()
  ) + 
  labs(y = "Wins") + 
  ggtitle(paste0("NL East thru ", max(nl_east_wins$up_to_date)))

p_a <- animate(p, renderer = gifski_renderer(loop = FALSE))


p_a
#anim_save("nleast.gif", p_a)

#![](nleast.gif)

```




